# An OS policy assignment to set up the Google Cloud Monitoring repository and
# install the Stackdriver agent for VMs running SUSE Linux Enterprise System OS.
osPolicies:
  - id: setup-repo-and-install-package-policy
    mode: ENFORCEMENT
    resourceGroups:
      - resources:
          - id: setup-repo
            repository:
              zypper:
                id: google-cloud-monitoring
                displayName: Google Cloud Monitoring Agent Repository
                baseUrl: https://packages.cloud.google.com/yum/repos/google-cloud-monitoring-sles15-x86_64-all
                gpgKeys:
                  - https://packages.cloud.google.com/yum/doc/yum-key.gpg
                  - https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg
          - id: install-pkg
            pkg:
              desiredState: INSTALLED
              zypper:
                name: stackdriver-agent
instanceFilter:
  osShortNames:
    - sles
rollout:
  disruptionBudget:
    fixed: 10
  minWaitDuration: 300s
