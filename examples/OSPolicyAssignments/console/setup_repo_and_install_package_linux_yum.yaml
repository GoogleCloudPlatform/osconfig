# An OS policy to set up the Google Cloud Monitoring repository and
# install the Stackdriver agent for VMs running either Red Hat Enterprise Linux and CentOS OSes.
id: setup-repo-and-install-package-policy
mode: ENFORCEMENT
resourceGroups:
  - resources:
      - id: setup-repo
        repository:
          yum:
            id: google-cloud-monitoring
            displayName: Google Cloud Monitoring Agent Repository
            baseUrl: https://packages.cloud.google.com/yum/repos/google-cloud-monitoring-el8-x86_64-all
            gpgKeys:
              - https://packages.cloud.google.com/yum/doc/yum-key.gpg
              - https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg
      - id: install-pkg
        pkg:
          desiredState: INSTALLED
          yum:
            name: stackdriver-agent
