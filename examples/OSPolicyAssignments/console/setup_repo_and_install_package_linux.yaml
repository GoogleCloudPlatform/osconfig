# This policy uses 2 resources. The resources are always executed in the order specified.
# 1. The `repository` resource is used to configure the Google Cloud Monitoring Yum repository.
# 2. The `package` resource is used to install the Stackdriver agent from the repo configured above.
id: setup-repo-and-install-package-policy
mode: ENFORCEMENT
resourceGroups:
  - resources:
      - id: setup-repo
        repository:
          yum:
            id: google-cloud-monitoring
            displayName: Google Cloud Monitoring Agent Repository
            baseUrl: https://packages.cloud.google.com/yum/repos/google-cloud-monitoring-el8-x86_64-all
            gpgKeys:
              - https://packages.cloud.google.com/yum/doc/yum-key.gpg
              - https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg
      - id: install-pkg
        pkg:
          desiredState: INSTALLED
          yum:
            name: stackdriver-agent
